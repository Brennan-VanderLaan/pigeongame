<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mesh Network Visualizer</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
</head>
<body>
    <!-- Auto-refresh indicator -->
    <div id="refreshIndicator" class="refresh-indicator">
        üîÑ Data refreshed
    </div>

    <!-- Polling controls -->
    <div class="polling-controls">
        <button id="pollingToggle" class="btn btn-success" onclick="togglePolling()">‚è∏Ô∏è Pause Auto-Refresh</button>
    </div>

    <div class="container">
        <h1>Mesh Network Visualizer</h1>

        <!-- Graph Visualization -->
        <div class="section graph-container">
            <h2>Network Topology Graph</h2>
            <div id="networkGraph"></div>
            <p style="margin-top: 10px; color: #666; font-size: 14px;">
                <strong>Legend:</strong>
                üîµ Nodes | üü† Hubs | ‚û°Ô∏è Hub-to-Hub Connections | ‚û°Ô∏è Node-to-Hub Links
            </p>
            <p style="margin-top: 5px; color: #0066cc; font-size: 13px;">
                üí° <strong>Tip:</strong> Drag nodes onto hubs to link them | Right-click nodes for more options
            </p>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-container">
            <div class="tab active" onclick="switchTab('management')">Management</div>
            <div class="tab" onclick="switchTab('topology')">Hub Topology</div>
        </div>

        <div id="managementTab" class="tab-content">
            <!-- Mesh Management -->
        <div class="section">
            <h2>Mesh Management</h2>
            <div class="flex">
                <div class="form-group">
                    <label for="meshName">Mesh Name:</label>
                    <input type="text" id="meshName" placeholder="Enter mesh name">
                </div>
                <div>
                    <button class="btn" onclick="createMesh()">Create Mesh</button>
                    <button class="btn" onclick="loadMeshes()">Refresh List</button>
                </div>
            </div>

            <div class="mesh-list" id="meshList">
                <p>Click "Refresh List" to load meshes</p>
            </div>
        </div>

        <!-- Node Management -->
        <div class="section">
            <h2>Node Management</h2>
            <div class="form-group">
                <label for="selectedMesh">Select Mesh:</label>
                <select id="selectedMesh">
                    <option value="">Select a mesh first</option>
                </select>
            </div>

            <!-- Quick Add Mode Toggle -->
            <div style="margin-bottom: 10px;">
                <button class="btn" onclick="toggleQuickAddMode()">‚ö° Quick Add Mode</button>
                <small style="color: #666; margin-left: 10px;">Add multiple nodes quickly with simple format</small>
            </div>

            <!-- Quick Add Interface (hidden by default) -->
            <div id="quickAddSection" class="quick-add-mode" style="display: none;">
                <h3>‚ö° Quick Add Nodes</h3>
                <p style="margin: 5px 0; font-size: 13px;">Format: name,address1,address2,... (one per line)</p>
                <textarea id="quickAddInput" placeholder="node1,10.0.0.1,192.168.1.1
node2,10.0.0.2
node3,10.0.0.3,172.16.0.1" style="width: 100%; height: 100px; font-family: monospace; margin-bottom: 10px;"></textarea>
                <button class="btn btn-success" onclick="quickAddNodes()">Add All Nodes</button>
                <button class="btn" onclick="toggleQuickAddMode()">Cancel</button>
            </div>

            <!-- Standard Add Interface -->
            <div id="standardAddSection">
                <div class="flex">
                    <div class="form-group">
                        <label for="nodeName">Node Name:</label>
                        <input type="text" id="nodeName" placeholder="Enter node name" onkeypress="if(event.key==='Enter') addNode()">
                    </div>
                    <div class="form-group">
                        <label for="nodeAddrs">Addresses (comma-separated):</label>
                        <input type="text" id="nodeAddrs" placeholder="192.168.1.1,10.0.0.1" onkeypress="if(event.key==='Enter') addNode()">
                    </div>
                    <div>
                        <button class="btn" onclick="addNode()">Add Node</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="nodeData">Node Data (JSON):</label>
                    <textarea id="nodeData" placeholder='{"role": "web-server", "environment": "production", "cpu_cores": 4}' style="height: 80px; font-family: monospace;"></textarea>
                    <small style="color: #666; font-size: 12px;">Optional: Add JSON metadata for this node (e.g., server config, deployment info, tags)</small>
                </div>
            </div>

            <div class="node-list" id="nodeList">
                <p>Select a mesh to view nodes</p>
            </div>
        </div>

        <!-- Hub Management -->
        <div class="section">
            <h2>Hub Management</h2>
            <div class="flex">
                <div class="form-group">
                    <label for="hubNodeSelect">Select Node to Make Hub:</label>
                    <select id="hubNodeSelect">
                        <option value="">Select a node</option>
                    </select>
                </div>
                <div>
                    <button class="btn" onclick="createHub()">Create Hub</button>
                    <button class="btn" onclick="loadHubs()">Refresh Hubs</button>
                </div>
            </div>

            <div class="hub-list" id="hubList">
                <p>Create hubs or refresh to view</p>
            </div>
        </div>

        <!-- Link Management -->
        <div class="section">
            <h2>Link Management</h2>
            <p style="color: #666; font-size: 14px; margin-bottom: 10px;">
                üí° <strong>Tip:</strong> Click on nodes/hubs above to auto-select them, or use dropdowns below
            </p>
            <div class="flex">
                <div class="form-group">
                    <label for="linkNodeSelect">Select Node:</label>
                    <select id="linkNodeSelect">
                        <option value="">Select a node</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="linkHubSelect">Select Hub:</label>
                    <select id="linkHubSelect">
                        <option value="">Select a hub</option>
                    </select>
                </div>
                <div>
                    <button class="btn btn-success" onclick="linkToHub()">Link to Hub</button>
                    <button class="btn btn-danger" onclick="unlinkFromHub()">Unlink from Hub</button>
                </div>
            </div>
        </div>

        <div id="messages"></div>
        </div>

        <!-- Hub Topology Tab -->
        <div id="topologyTab" class="tab-content" style="display: none;">
            <!-- Hub Connection Management -->
            <div class="section">
                <h2>Hub-to-Hub Connections</h2>
                <p style="color: #666; font-size: 14px; margin-bottom: 10px;">
                    üí° <strong>Tip:</strong> Click on hubs in the Hub Management tab to auto-select them here
                </p>
                <div class="flex">
                    <div class="form-group">
                        <label for="sourceHubSelect">Source Hub:</label>
                        <select id="sourceHubSelect">
                            <option value="">Select source hub</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="targetHubSelect">Target Hub:</label>
                        <select id="targetHubSelect">
                            <option value="">Select target hub</option>
                        </select>
                    </div>
                    <div>
                        <button class="btn btn-success" onclick="connectHubs()">Connect Hubs</button>
                        <button class="btn btn-danger" onclick="disconnectHubs()">Disconnect Hubs</button>
                    </div>
                </div>
            </div>

            <!-- Hub Topology Display -->
            <div class="section">
                <h2>Hub Network Topology</h2>
                <div id="hubTopologyList">
                    <p>Select a mesh to view hub connections</p>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
