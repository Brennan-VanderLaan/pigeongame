<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mesh Network Visualizer</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
</head>
<body>
    <!-- Auto-refresh indicator -->
    <div id="refreshIndicator" class="refresh-indicator">
        Refreshed
    </div>

    <!-- Polling controls -->
    <div class="polling-controls">
        <button id="pollingToggle" class="btn btn-success" onclick="togglePolling()">⏸ Pause</button>
    </div>

    <div class="container">
        <h1>Mesh Network Visualizer</h1>

        <!-- Messages at the top -->
        <div id="messages"></div>

        <!-- Graph Visualization with Details Panel -->
        <div class="section graph-container">
            <h2>Topology</h2>
            <div class="graph-with-details">
                <div id="networkGraph"></div>
                <div class="graph-controls">
                    <button class="graph-btn" onclick="zoomIn()" title="Zoom In">+</button>
                    <button class="graph-btn" onclick="zoomOut()" title="Zoom Out">−</button>
                    <button class="graph-btn" onclick="fitGraph()" title="Fit to Screen">⊡</button>
                </div>
                <div id="detailsPanel" class="details-panel collapsed">
                    <div class="details-header">
                        <h3>Details</h3>
                        <button class="btn-close" onclick="closeDetailsPanel()">✕</button>
                    </div>
                    <div id="detailsContent" class="details-content">
                        <p style="color: #999; text-align: center; margin-top: 50px;">Select a node or hub to view details</p>
                    </div>
                </div>
            </div>
            <p style="margin: 4px 0 0 0; color: #666; font-size: 10px;">
                <strong>Legend:</strong> Blue=Nodes | Orange=Hubs | Red=Hub↔Hub | Green=Node→Hub
                <span style="margin-left: 10px; color: #0066cc;">Drag to link | Right-click for options</span>
            </p>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-container">
            <div class="tab active" onclick="switchTab('management')">Management</div>
            <div class="tab" onclick="switchTab('topology')">Hubs</div>
        </div>

        <div id="managementTab" class="tab-content">
            <div class="grid-2col">
                <!-- Left Column -->
                <div>
                    <!-- Mesh Management -->
                    <div class="section">
                        <h2>Meshes</h2>
                        <div class="flex">
                            <div class="form-group">
                                <label for="meshName">Name:</label>
                                <input type="text" id="meshName" placeholder="mesh name">
                            </div>
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div>
                                    <button class="btn" onclick="createMesh()">Create</button>
                                    <button class="btn" onclick="loadMeshes()">Refresh</button>
                                </div>
                            </div>
                        </div>
                        <div class="mesh-list" id="meshList">
                            <p>No meshes</p>
                        </div>
                    </div>

                    <!-- Node Management -->
                    <div class="section">
                        <h2>Nodes</h2>
                        <div class="form-group">
                            <label for="selectedMesh">Mesh:</label>
                            <select id="selectedMesh">
                                <option value="">Select mesh</option>
                            </select>
                        </div>

                        <!-- Quick Add Mode Toggle -->
                        <div style="margin-bottom: 6px;">
                            <button class="btn" onclick="toggleQuickAddMode()">Bulk Add</button>
                        </div>

                        <!-- Quick Add Interface (hidden by default) -->
                        <div id="quickAddSection" class="quick-add-mode" style="display: none;">
                            <h3>Bulk Add</h3>
                            <p style="margin: 2px 0; font-size: 0.7rem;">name,addr1,addr2,...</p>
                            <textarea id="quickAddInput" placeholder="node1,10.0.0.1,192.168.1.1
node2,10.0.0.2
node3,10.0.0.3,172.16.0.1" style="width: 100%; height: 60px; font-family: monospace; margin-bottom: 6px; font-size: 0.7rem;"></textarea>
                            <button class="btn btn-success" onclick="quickAddNodes()">Add</button>
                            <button class="btn" onclick="toggleQuickAddMode()">Cancel</button>
                        </div>

                        <!-- Standard Add Interface -->
                        <div id="standardAddSection">
                            <div class="flex">
                                <div class="form-group">
                                    <label for="nodeName">Name:</label>
                                    <input type="text" id="nodeName" placeholder="node name" onkeypress="if(event.key==='Enter') addNode()">
                                </div>
                                <div class="form-group">
                                    <label for="nodeAddrs">Addresses:</label>
                                    <input type="text" id="nodeAddrs" placeholder="10.0.0.1,..." onkeypress="if(event.key==='Enter') addNode()">
                                </div>
                                <div>
                                    <button class="btn" onclick="addNode()">Add</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="nodeData">Data (JSON):</label>
                                <textarea id="nodeData" placeholder='{"role":"web"}' style="height: 40px; font-family: monospace; font-size: 0.7rem;"></textarea>
                            </div>
                        </div>

                        <div class="node-list" id="nodeList">
                            <p>No nodes</p>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div>
                    <!-- Hub Management -->
                    <div class="section">
                        <h2>Hubs</h2>
                        <div class="flex">
                            <div class="form-group">
                                <label for="hubNodeSelect">Node:</label>
                                <select id="hubNodeSelect">
                                    <option value="">Select node</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div>
                                    <button class="btn" onclick="createHub()">Create</button>
                                    <button class="btn" onclick="loadHubs()">Refresh</button>
                                </div>
                            </div>
                        </div>

                        <div class="hub-list" id="hubList">
                            <p>No hubs</p>
                        </div>
                    </div>

                    <!-- Link Management -->
                    <div class="section">
                        <h2>Links</h2>
                        <div class="flex">
                            <div class="form-group">
                                <label for="linkNodeSelect">Node:</label>
                                <select id="linkNodeSelect">
                                    <option value="">Select node</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="linkHubSelect">Hub:</label>
                                <select id="linkHubSelect">
                                    <option value="">Select hub</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div>
                                    <button class="btn btn-success" onclick="linkToHub()">Link</button>
                                    <button class="btn btn-danger" onclick="unlinkFromHub()">Unlink</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hub Topology Tab -->
        <div id="topologyTab" class="tab-content" style="display: none;">
            <div class="grid-2col">
                <!-- Hub Connection Management -->
                <div class="section">
                    <h2>Connections</h2>
                    <div class="flex">
                        <div class="form-group">
                            <label for="sourceHubSelect">Source:</label>
                            <select id="sourceHubSelect">
                                <option value="">Select hub</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="targetHubSelect">Target:</label>
                            <select id="targetHubSelect">
                                <option value="">Select hub</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div>
                                <button class="btn btn-success" onclick="connectHubs()">Connect</button>
                                <button class="btn btn-danger" onclick="disconnectHubs()">Disconnect</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hub Topology Display -->
                <div class="section">
                    <h2>Summary</h2>
                    <div id="hubTopologyList">
                        <p>No data</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
