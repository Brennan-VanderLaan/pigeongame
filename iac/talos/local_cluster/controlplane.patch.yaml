version: v1alpha1 # Indicates the schema used to decode the contents.
debug: false # Enable verbose logging to the console.
persist: true # Indicates whether to pull the machine config upon every boot.
# Provides machine specific configuration options.
machine:
#  kernel:
#    modules:
#      - name: nvidia
#      - name: nvidia_uvm
#      - name: nvidia_drm
#      - name: nvidia_modeset
  certSANs:
    - 10.12.0.4
  type: controlplane # Defines the role of the machine within the cluster.
  kubelet:
    nodeIP:
      validSubnets:
        - 10.12.0.0/24
  network:
    # Configures KubeSpan feature.
    kubespan:
      enabled: false
  nodeLabels:
    ingress-ready: true
  features:
    hostDNS: # make container mode happy 1.7.1
      enabled: true
      forwardKubeDNSToHost: true
    rbac: true # Enable role-based access control (RBAC).
    # # Configure Talos API access from Kubernetes pods.
    kubernetesTalosAPIAccess:
      enabled: true # Enable Talos API access from Kubernetes pods.
      # The list of Talos API roles which can be granted for access from Kubernetes pods.
      allowedRoles:
        - os:reader
      # The list of Kubernetes namespaces Talos API access is available from.
      allowedKubernetesNamespaces:
        - kube-system
  sysctls:
     net.ipv4.ip_forward: 1

# Provides cluster specific configuration options.
cluster:
  controlPlane:
    endpoint: https://10.12.0.4:6443
  network:
    podSubnets:
      - 10.244.0.0/16
    # The service subnet CIDR.
    serviceSubnets:
      - 10.96.0.0/12
    cni:
      name: flannel
  allowSchedulingOnControlPlanes: true
  # Configures cluster member discovery.
  discovery:
    enabled: false # Enable the cluster membership discovery feature.
    # Configure registries used for cluster member discovery.
    registries:
      # Kubernetes registry uses Kubernetes API server to discover cluster members and stores additional information
      kubernetes:
        disabled: false # Disable Kubernetes discovery registry.
      # Service registry is using an external service to push and pull information about cluster members.
      service:
        endpoint: ''
  apiServer:
     # Extra certificate subject alternative names for the API server's certificate.
     certSANs:
         - 10.12.0.0/24